---
title: "Next.js App router × Docker × vscode デバッグ方法"
emoji: "🦁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [nextjs, docker, vscode, debug]
published: false
---

## 問題
Next.js 13以降で、下記のコマンドでNext.jsが起動できない旨が報告されていた。
```bash
NODE_OPTIONS='--inspect=0.0.0.0' next dev
```
https://github.com/vercel/next.js/issues/53127

Next.jsをデバッグする場合、下記のコマンドが一般的で、このときNext.jsはローカルホストからのアクセスのみを受け付ける。
```bash
NODE_OPTIONS='--inspect' next dev
```
そのためホスト環境Next.jsサーバーを起動している場合は問題ないものの、
Docker上でサーバーを動かしている場合、問題になっていた。

## 解決策
1. `v14.3.0-canary.23`以降のバージョンのNext.jsを利用する
https://github.com/vercel/next.js/releases/tag/v14.3.0-canary.23
Next.js のバージョンを変えるのが容易な人、新しくプロジェクトを開始する方におすすめの方法。

2. node_modulesのバグの原因となっている場所を書き換える
業務でNext.jsにさわっていて、簡単にプロジェクトのnextのバージョンを変えられない方におすすめ。
本記事ではこちらの方法を解説します。
（最近ようやくバグが修正されるまで、筆者はずっとこちらの方法で解決してきました。）

問題修正のプルリクエスト。最近更新があった。
https://github.com/vercel/next.js/pull/65006

このリリースで修正された。
https://github.com/vercel/next.js/releases/tag/v14.3.0-canary.23

14.3.0 のcanaryを使わないとDockerでのデバッグはできない
https://www.npmjs.com/package/next/v/14.3.0-canary.28

最新版には簡単に更新できない人のためのワークアラウンド的解決策
