---
title: "Remotely save × github × Quartz によるクラウド同期で快適&無料なObsidianホスティング"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [obsidian, quartz, remotelySave, githubActions]
published: false
---

Obsidian といえば、公式のクラウド同期サービスとして `Obsidian Sync`、
ホスティングは`Obsidian Publish`が有名ですが、どちらも月額で料金がかかります。

円安のご時世で毎月ドルで課金というのも中々ハードル高いですね。

そこで、無料で使えるコミュニティプラグイン、クラウド同期サービスとして `Remotely save`、
ホスティングは`Quartz`を使って代替しようと考えました。

# 前提

以下の2つができることが条件になります。
- [Quartz](https://quartz.jzhao.xyz/) でデプロイができる
- [RemotelySave](https://github.com/remotely-save/remotely-save) で同期ができる

上記2つの設定方法はは公式ページや別の利用者の方の説明記事があるので、当記事では説明しません。
`github actions`の設定方法が記事のメインの内容となります。

# 流れ

1. ローカルで編集
2. AWS S3 にデータをバックアップ
3. 毎日定時に github actions で S3 と同期して自動でコミット
4. `Quartz`でホスティングしているサイトに更新がかかる

2までの流れは通常の`Remotely Save`と同じで、そこから`github actions`で`Quartz`のデプロイ設定を行っているリポジトリにデータを同期して自動でコミットするイメージです。

# 方法

1. Quartz でホスティングを行う
下記の公式サイトを参考にホスティングを行います。
https://quartz.jzhao.xyz/
`content` ディレクトリはまだ空のままにしておきます。

2. Remotely save でクラウド同期を行う
下記の公式リポジトリを参考に同期の設定を行います。
https://github.com/remotely-save/remotely-save
当記事ではAWS S3を使って解説します。
(後述する`aws s3 sync`のようにクラウドからローカルにファイルをダウンロードして同期できるようなコマンドが存在していれば、Dropbox等でも利用可能です。)

3. github actions の設定
1.でホスティングした際のgithubリポジトリに、環境変数`AWS_ACCESS_KEY_ID`、`AWS_SECRET_ACCESS_KEY`をセットします。
`settings/Secrets and variables/Actions` から設定可能です。
![](https://storage.googleapis.com/zenn-user-upload/c7a7b0424a28-20240730.png)
また、`settings/Actions/General` の`Workflow permissions` が `Read and write permissions`になっていることを確認してください。(github actionがリポジトリのcommit&pushを行うのに必要です)
![](https://storage.googleapis.com/zenn-user-upload/f0220636f5bd-20240730.png)

 `.github/workflows/sync_s3.yaml`ファイルを新たに作成し、以下のyamlを記載します。
```yml
name: Sync and Commit S3 Data

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch: # 手動トリガー

jobs:
  fetch_and_commit:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ap-northeast-1

    - name: Fetch data from S3
      run: aws s3 sync s3://xxx-your-own-s3-bucket-name-xxx ./content --delete

    - name: check for changes
      id: git_diff
      run: |
        git add .
        echo "{count}={$(git diff --name-only | wc -l)}" >> $GITHUB_OUTPUT

    - name: Commit changes
      if: steps.git_diff.outputs.count > 0
      run: |
        git config --global user.name 'github-actions'
        git config --global user.email 'github-actions@github.com'
        git add .
        git commit -m 'Sync data with S3'
        git push origin v4
```
上記に `run: aws s3 sync s3://xxx-your-own-s3-bucket-name-xxx ./content --delete`
というコマンドがあると思いますが、ここには自分で設定したs3バケットの名前を入れるようにしてください。

※Dropbox 等で同期を行っている方は、適宜 aws cliのコマンドを書き換えて実行してください。


# 経緯と以前のモヤモヤ
元々、`Quartz`と[obsidian-git](https://github.com/Vinzent03/obsidian-git)でクラウド同期とホスティングを行っていましたが、`obsidian-git`ではコミット頻度が高すぎてgithubに不毛なコミット履歴が積み重なるのがモヤモヤしていました。

また、pushの回数も多くなりがちで、CIが過剰に動いてしまうというのも懸念事項でした。

かといって設定でpushの頻度を下げればクラウド同期が上手く行かない可能性も生じる、ということでクラウド同期に関しては`Remotely save`で自動同期することにし、一日一回`github`側で自動コミットして`Quartz`にデプロイできたら便利だと考えたのがこの発想の経緯です。

この方法であれば、コミットするタイミングでpcが起動していなくてもS3とgithubで自動で同期できます。

また、この方法を採用することでRemotely Saveの良い点は活用しつつ、
一日ごとにgithubで差分のスナップショットがとれ、過去ログを振り返ったり
1コミットが1日の作業に対応するため1週間の作業量などの可視化もできるというおまけつきです。

# memo あとで消す

bot はその先の CI をキックしない
https://umihi.co/blog/20221019-run-gh-as-actual-user-instead-of-github-actions-bot-in-actions
